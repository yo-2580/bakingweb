<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>גלריית מוצרים | שם הקונדיטוריה</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="main-header">
        <div class="container">
            <a href="index.html" class="logo">שם הקונדיטוריה</a>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">דף הבית</a></li>
                    <li><a href="gallery.html" class="active">גלריה</a></li>
                    <li><a href="about.html">אודות</a></li>
                    <li><a href="contact.html">יצירת קשר</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="page-header">
            <h1>הגלריה המלאה</h1>
            <p>כל היצירות שלנו מחולקות לפי קטגוריות. רחפו מעל קטגוריה כדי לראות תמונות נוספות.</p>
        </section>

        <section class="gallery-section" style="padding-top: 0;">
            <div class="container">
                <div class="gallery-grid">
                    <!-- שורה 1 -->
                    <a href="category.html?name=עוגה" class="category-card"><img src="images/עוגה/0001.jpg" alt="עוגה"><div class="category-card-title">עוגה</div></a>
                    <a href="category.html?name=מזל טוב סבא" class="category-card"><img src="images/מזל טוב סבא/0001.jpg" alt="מזל טוב סבא"><div class="category-card-title">מזל טוב סבא</div></a>
                    <a href="category.html?name=לקקני דובי חמודים" class="category-card"><img src="images/לקקני דובי חמודים/0001.jpg" alt="לקקני דובי חמודים"><div class="category-card-title">לקקני דובי חמודים</div></a>
                    <a href="category.html?name=כוסות מוס תות" class="category-card"><img src="images/כוסות מוס תות/0001.jpg" alt="כוסות מוס תות"><div class="category-card-title">כוסות מוס תות</div></a>
                    <a href="category.html?name=כוסות מוס" class="category-card"><img src="images/כוסות מוס/0001.jpg" alt="כוסות מוס"><div class="category-card-title">כוסות מוס</div></a>
                    <a href="category.html?name=יום הולדת תאומים" class="category-card"><img src="images/יום הולדת תאומים/0001.jpg" alt="יום הולדת תאומים"><div class="category-card-title">יום הולדת תאומים</div></a>
                    <a href="category.html?name=בת מצווה נועה" class="category-card"><img src="images/בת מצווה נועה/0001.jpg" alt="בת מצווה נועה"><div class="category-card-title">בת מצווה נועה</div></a>
                    <a href="category.html?name=בר מושקע לבר מצווה" class="category-card"><img src="images/בר מושקע לבר מצווה/0001.jpg" alt="בר מושקע לבר מצווה"><div class="category-card-title">בר מושקע לבר מצווה</div></a>
                    <a href="category.html?name=בר בת מצווה אילה" class="category-card"><img src="images/בר בת מצווה אילה/0001.jpg" alt="בר בת מצווה אילה"><div class="category-card-title">בר בת מצווה אילה</div></a>

                    <!-- שורה 2 -->
                    <a href="category.html?name=עוגיות ומאפינס חלאקה" class="category-card"><img src="images/עוגיות ומאפינס חלאקה/0001.jpg" alt="עוגיות ומאפינס חלאקה"><div class="category-card-title">עוגיות ומאפינס חלאקה</div></a>
                    <a href="category.html?name=עוגת שוקולד שבור" class="category-card"><img src="images/עוגת שוקולד שבור/0001.jpg" alt="עוגת שוקולד שבור"><div class="category-card-title">עוגת שוקולד שבור</div></a>
                    <a href="category.html?name=עוגת קונספט לאירוע" class="category-card"><img src="images/עוגת קונספט לאירוע/0001.jpg" alt="עוגת קונספט לאירוע"><div class="category-card-title">עוגת קונספט לאירוע</div></a>
                    <a href="category.html?name=עוגת מספרים לבת מצווה" class="category-card"><img src="images/עוגת מספרים לבת מצווה/0001.jpg" alt="עוגת מספרים לבת מצווה"><div class="category-card-title">עוגת מספרים לבת מצווה</div></a>
                    <a href="category.html?name=עוגת מספרים 16" class="category-card"><img src="images/עוגת מספרים 16/0001.jpg" alt="עוגת מספרים 16"><div class="category-card-title">עוגת מספרים 16</div></a>
                    <a href="category.html?name=עוגת יום הולדת ורוד" class="category-card"><img src="images/עוגת יום הולדת ורוד/0001.jpg" alt="עוגת יום הולדת ורוד"><div class="category-card-title">עוגת יום הולדת ורוד</div></a>
                    <a href="category.html?name=עוגת טיפטופים" class="category-card"><img src="images/עוגת טיפטופים/0001.jpg" alt="עוגת טיפטופים"><div class="category-card-title">עוגת טיפטופים</div></a>
                    <a href="category.html?name=עוגה לחלאקה" class="category-card"><img src="images/עוגה לחלאקה/0001.jpg" alt="עוגה לחלאקה"><div class="category-card-title">עוגה לחלאקה</div></a>
                    <a href="category.html?name=עוגה ורודה" class="category-card"><img src="images/עוגה ורודה/0001.jpg" alt="עוגה ורודה"><div class="category-card-title">עוגה ורודה</div></a>

                    <!-- שורה 3 -->
                    <a href="category.html?name=פרלינים" class="category-card"><img src="images/פרלינים/0001.jpg" alt="פרלינים"><div class="category-card-title">פרלינים</div></a>
                    <a href="category.html?name=פרלין תכלת" class="category-card"><img src="images/פרלין תכלת/0001.jpg" alt="פרלין תכלת"><div class="category-card-title">פרלין תכלת</div></a>
                    <a href="category.html?name=פרלין לקקן שוקולד" class="category-card"><img src="images/פרלין לקקן שוקולד/0001.jpg" alt="פרלין לקקן שוקולד"><div class="category-card-title">פרלין לקקן שוקולד</div></a>
                    <a href="category.html?name=פרלין ארטיק שוקולד" class="category-card"><img src="images/פרלין ארטיק שוקולד/0001.jpg" alt="פרלין ארטיק שוקולד"><div class="category-card-title">פרלין ארטיק שוקולד</div></a>
                    <a href="category.html?name=פרלין" class="category-card"><img src="images/פרלין/0001.jpg" alt="פרלין"><div class="category-card-title">פרלין</div></a>
                    <a href="category.html?name=פלטת פרלינים לבר" class="category-card"><img src="images/פלטת פרלינים לבר/0001.jpg" alt="פלטת פרלינים לבר"><div class="category-card-title">פלטת פרלינים לבר</div></a>
                    <a href="category.html?name=פלטת פרלינים ולבבות" class="category-card"><img src="images/פלטת פרלינים ולבבות/0001.jpg" alt="פלטת פרלינים ולבבות"><div class="category-card-title">פלטת פרלינים ולבבות</div></a>
                    <a href="category.html?name=פלטת פרלינים" class="category-card"><img src="images/פלטת פרלינים/0001.jpg" alt="פלטת פרלינים"><div class="category-card-title">פלטת פרלינים</div></a>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2024 כל הזכויות שמורות ל"שם הקונדיטוריה"</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cards = document.querySelectorAll('.category-card');
            const animationInterval = 1500;
            const galleryData = {};

            // --- פונקציות עזר ---
            const preloadImagesForCategory = (categoryName) => {
                return new Promise((resolve) => {
                    galleryData[categoryName] = [];
                    const loadImage = (index) => {
                        if (index > 20) { resolve(); return; }
                        const imagePath = `images/${categoryName}/${index.toString().padStart(4, '0')}.jpg`;
                        const tempImage = new Image();
                        tempImage.src = imagePath;
                        tempImage.onload = () => {
                            galleryData[categoryName].push(imagePath);
                            loadImage(index + 1);
                        };
                        tempImage.onerror = () => resolve();
                    };
                    loadImage(1);
                });
            };

            const updateActiveDot = (card, index) => {
                const dots = card.querySelectorAll('.dot');
                dots.forEach((dot, i) => dot.classList.toggle('active', i === index));
            };
            
            // פונקציה מרכזית לעדכון התמונה והנקודות
            const updateCardVisuals = (card, index) => {
                const imgElement = card.querySelector('img');
                const imagePaths = galleryData[card.dataset.categoryName];

                if (!imgElement || !imagePaths) return;
                
                card.dataset.currentIndex = index;
                updateActiveDot(card, index);

                imgElement.style.opacity = '0';
                setTimeout(() => {
                    imgElement.src = imagePaths[index];
                    imgElement.style.opacity = '1';
                }, 250);
            };

            const createDotsAndListeners = (card, imagePaths) => {
                const dotsContainer = document.createElement('div');
                dotsContainer.className = 'dots-container';
                
                imagePaths.forEach((path, i) => {
                    const dot = document.createElement('span');
                    dot.className = 'dot';
                    if (i === 0) dot.classList.add('active');
                    
                    // הוספת מאזין לחיצה לכל נקודה
                    dot.addEventListener('click', (event) => {
                        event.preventDefault();  // מונע מהקישור הראשי לפעול
                        event.stopPropagation(); // מונע מהאירוע להמשיך "לבעבע" למעלה
                        
                        // קפוץ לתמונה שנלחצה
                        updateCardVisuals(card, i);
                    });
                    
                    dotsContainer.appendChild(dot);
                });
                card.appendChild(dotsContainer);
            };
            
            // --- לוגיקה ראשית ---
            const initializeCard = (card) => {
                const urlParams = new URLSearchParams(card.href.split('?')[1]);
                const categoryName = urlParams.get('name');
                card.dataset.categoryName = categoryName; // שמירת שם הקטגוריה על הכרטיס
                const imagePaths = galleryData[categoryName];

                if (imagePaths && imagePaths.length > 1) {
                    createDotsAndListeners(card, imagePaths);

                    card.addEventListener('mouseenter', () => {
                        card.animationTimer = setInterval(() => {
                            let currentIndex = parseInt(card.dataset.currentIndex || 0);
                            const nextIndex = (currentIndex + 1) % imagePaths.length;
                            updateCardVisuals(card, nextIndex);
                        }, animationInterval);
                    });

                    card.addEventListener('mouseleave', () => {
                        clearInterval(card.animationTimer);
                        updateCardVisuals(card, 0); // איפוס לתמונה הראשונה
                    });
                }
            };
            
            // התחלת התהליך
            const preloadPromises = Array.from(cards).map(card => {
                const urlParams = new URLSearchParams(card.href.split('?')[1]);
                return preloadImagesForCategory(urlParams.get('name'));
            });
            
            Promise.all(preloadPromises).then(() => {
                console.log('All images preloaded. Initializing cards...');
                cards.forEach(initializeCard);
            });
        });
    </script>
</body>
</html>